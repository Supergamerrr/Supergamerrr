HOME=/home/container
echo "Установка Windows 7.."
if ! [ -f $HOME/ngrok ];
then
wget -O w7x64.img https://bit.ly/akuhnetw7X64
fi
if ! [ -f $HOME/ngrok ];
then
echo "Установка ngrok..."
wget https://bin.equinox.io/c/4VmDzA7iaHb/ngrok-stable-linux-amd64.zip > /dev/null 2>&1
unzip ngrok-stable-linux-amd64.zip > /dev/null 2>&1
fi
read -p "Ваш токен ngrok: " CRP 
./ngrok authtoken $CRP 
nohup ./ngrok tcp 3388 &>/dev/null &
echo "Установка программы qemu что-бы создать и запустить виртуальную машину."
apt install qemu-kvm qemu
echo "Перед подключением рекомендуется подождать 1-2 минуты"
echo "Вот ваш IP! Если его тут нету то подождите 5-15 секунд."
curl --silent --show-error http://127.0.0.1:4040/api/tunnels | sed -nE 's/.*public_url":"tcp:..([^"]*).*/\1/p'
echo "Виртуальная машина ещё не готова! Нам нужно её настроить."
read -p "Сколько ядер вы желайте? Максимум 12 ядер" CORES
qemu-system-x86_64 -hda w7x64.img -m 3G -smp cores=$CORES -net user,hostfwd=tcp::3388-:3389 -net nic -object rng-random,id=rng0,filename=/dev/urandom -device virtio-rng-pci,rng=rng0 -vga vmware -nographic
